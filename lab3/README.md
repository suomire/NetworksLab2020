# Лабораторная работа №3
## Реализация протокола обмена файлами TFTP в соответствии с RFC
`tftp_client.py` - приложение-клиент;
`tftp_server.py` - серверное приложение;
`client_utils.py` - функции для работы клиентского приложения;
`server_utils.py` - функции для работы серверного приложения;
`tftp_utils.py` - общие конструкции для работы tftp-протокола;


###  Описание работы

Работа серверного приложение организована с помощью потоков. 
После создания серверного сокета, который принимает UDP запросы по указанному порту, 
начинает работать главный поток серверного приложения, принимающий UDP сообщения. 
Когда приходит сообщение, оно обрабатывается методом `process_data`, 
чтобы получить оттуда информацию о поступившем запросе. 
Если запрос на чтение или запись, то сервер создает новый поток для этого подключения. 
В нем заносится информация в словарь о том, 
что началась процедура работы с клиентом по указанному адресу. 
Эта запись будет удалена в случае успешного завершения сессии 
или в случае возникновения ошибки. 
Далее этот потом запускает либо метод на отправку файла с сервера, либо на запись файла. 
Вся дальнейшая работа происходит в них. 

Главный поток сервера продолжает мониторить входящие сообщения. 
Чтобы организовать отправку полученных ACK и DATA сообщений используются возможности модуля `queue.Queue`. 
Существуют две очереди (для ACK и DATA сообщений), в которые помещаются сообщения с таким кодом. 
Если адрес, с которого они пришли, уже знаком серверу. В методах-обработчиках сообщения из этой очереди достаются. 
Если изъятое сообщение от другого адреса, то оно помещается обратно в очередь. 
Также методы обеспечивают повторную отправку сообщения ACK или DATA, если возникает несоответствие между номерами блоков. 

Для формирования сообщений с определенным OPCODE использовались соответствующие классы из `tftp_utils.py`.
Это решение может показаться избыточным, но такой способ был выбран, чтобы попробовать использовать Python3 в рамках ООП.
Также это помогло разобраться с разными форматами сообщений в удобной для меня форме.
Файл `tftp_utils.py` содержит метод для обработки сообщений, структуру для хранения кодов операций и кодов сообщений об ошибках. 


Приложение-клиент работает как консольная утилита. Все аргументы вводятся в командную строку при вызове `tftp_client.py`:
команда (get/put), имя файла, адрес сервера, порт сервера, таймаут (опционально). 
Такой путь был выбран для ознакомления с модулем `argparse`.
После успешного ввода всех аргументов программа запускается, 
создает запрос, проверяет на ошибку существования файла на стороне клиента и только потом запускает
соответствующий запрошенной операции метод из `client_utils.py`. Уже в этом методе создается сокет,
отправляет запрос и происходят все дальнейшие действия по отправке/получению файла, в том числе и обработка некоторых ошибок. 