# Лабораторная работа №4
## Калькулятор
`server.py` - серверное приложение;
`сlient.py` - приложение-клиент;

###  Описание работы

Разработать приложение-сервер «Удаленный калькулятор», позволяющее по запросу выполнять математические операции, и удаленный клиент для сервера.

Система "Калькулятор" для обмена сообщениями использовала протокол TCP.
Во время начала работы приложения-сервера задавался серверный сокет, 
прикреплялся к указанному адресу и начинал прослушивать события на этом сокете.
Аналогично первой лабораторной работе для обработки нескольких клиентов использовался механизм
многопоточности. После подключение клиента стартовал поток-обработчик.
Он принимал входящее сообщение в формате JSON, передавал загруженное сообщение методу `get_answer` или
`long_calculations`, в которых уже производились расчеты.
Быстрые вычисления производятся в том же потоке, что и обработка сообщений от подключенного клиента.
Сразу после подсчета результат отправляется клиенту.
Долгие вычисления производятся в отдельном потоке и отправляются клиенту потом из этого же потока.
Для имитации долгих вычислений использовалась функция time.sleep(n).

Формат входящих сообщений (быстрые вычисления):

{
"opcode": NUM, 
"num1": ARG1, 
"num2": ARG2, 
"op_type": KIND_OF_OP, 
"id": ID
 }
 
 Формат входящих сообщений (долгие вычисления):

{ "opcode": NUM,
 "arg": ARG1,
 "op_type": KIND_OF_OP,
 "id": ID
}

Формат исходящих сообщений: 


{ "opcode": ANS, 
"num": NUM,
 "id": ID 
}


Opcode -- код выполняемой арифметической операции, num1/num2 -- аргументы, op_type -- тип выполняемой операции,
id -- идентификатор запроса на вычисление, используется клиентом для идентификации ответов при использовании долгих вычислений. 

Обработка отключения обрабатывается двумя способами.
Первый вариант отключения --  при котором, соединение закрывается на стороне клиента и приходит сообщение с нулевой длиной. Метод, который осуществляет обработку клиентских запросов закрывает соединение при получении сообщения нулевой длины. Второй сценарий -- это сценарий, при котором на стороне клиента возникает какая-то ошибка на сторне клиента и он присылает пакеты с установленным флагом RST. Такая ситуация обрабатывается сервером и соединение закрывается. 
